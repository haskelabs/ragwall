version: '3.8'

services:
  ragwall-api:
    build: .
    container_name: ragwall-api
    ports:
      - "8000:8000"
    environment:
      # RagWall configuration
      - RAGWALL_VECTORS=/app/experiments/results/tiny_jb_vectors.pt
      - RAGWALL_MODEL=distilgpt2  # Internal model for security analysis
      - RAGWALL_MODE=auto         # Two-stage: rules first, model if needed
      - RAGWALL_LAYER=transformer.h.1
      - RAGWALL_POOL_K=6
      - RAGWALL_PENALTY=0.2
      - RAGWALL_QUORUM=2
      
      # Note: RagWall is embedding-model agnostic!
      # It works with ANY embedding model your RAG uses:
      # - OpenAI ada-002
      # - all-MiniLM-L6-v2
      # - all-mpnet-base-v2
      # - e5-large-v2
      # - bge-large-en
      # - instructor-xl
      # RagWall sanitizes BEFORE embedding, so it's compatible with all
      
    volumes:
      - ./experiments/results:/app/experiments/results:ro
    restart: unless-stopped
    networks:
      - ragwall-network
    
  ragwall-web:
    image: nginx:alpine
    container_name: ragwall-web
    ports:
      - "80:80"
    volumes:
      - ./public:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - ragwall-api
    restart: unless-stopped
    networks:
      - ragwall-network

networks:
  ragwall-network:
    driver: bridge
